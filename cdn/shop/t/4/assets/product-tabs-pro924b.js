const keyCodes={TAB:"tab",ENTER:"enter",ESC:"escape",SPACE:" ",END:"end",HOME:"home",LEFT:"arrowleft",UP:"arrowup",RIGHT:"arrowright",DOWN:"arrowdown"};function debounce(fn,wait){let t;return(...args)=>{clearTimeout(t),t=setTimeout(()=>fn.apply(this,args),wait)}}function promiseTransitionEnd(element){const events=["webkitTransitionEnd","otransitionend","oTransitionEnd","msTransitionEnd","transitionend"],properties=["WebkitTransition","MozTransition","OTransition","msTransition","transition"];let duration=0,promise=Promise.resolve();return properties.forEach(()=>{duration||(duration=parseFloat(window.getComputedStyle(element).transitionDuration))}),duration>0&&(promise=new Promise(resolve=>{const handlers=events.map(event=>(element.addEventListener(event,handler),{event,handler}));function handler(event){event.target===element&&(handlers.forEach(({event:event2,handler:handler2})=>{element.removeEventListener(event2,handler2)}),resolve())}})),promise}function isIntersectionObserverAvailable(){return"IntersectionObserver"in window&&"IntersectionObserverEntry"in window&&"intersectionRatio"in window.IntersectionObserverEntry.prototype}const selectorsScroller={arrow:"[data-scroller-arrow]",menu:"[data-scroller-content]",wrapper:"[data-scroller-wrapper]"},selectorsScrollerContent={noTransition:"scroller-content--no-transition",wrapper:"scroller-wrapper"},config={offset:150};class Scroller{constructor(container){this.container=container}init(){this.wrapper=this.container.querySelector(selectorsScroller.wrapper),this.wrapper&&(this.initialized=!0,this.menu=this.wrapper.querySelector(selectorsScroller.menu),this.arrows=this.container.querySelectorAll(selectorsScroller.arrow),this.isTransitioning=!1,this._setupEventHandlers(),this._recalculateOverflow())}makeElementVisible(element){if(this.overflowValue==="none"||!this.initialized)return;let elementVisible=!0;const offset=config.offset/2,elementRect=element.getBoundingClientRect(),elementLeft=Math.floor(elementRect.left)-offset,elementRight=Math.floor(elementRect.right)+offset;if(this.wrapperRect||this._recalculateOverflow(),elementRight>this.wrapperRect.right?(this.direction="next",elementVisible=!1):elementLeft<this.wrapperRect.left&&(this.direction="previous",elementVisible=!1),elementVisible||this.isTransitioning)return;this.isTransitioning=!0;const distance=this._getDistanceToElement(elementRight,element.offsetLeft,offset);this._setMenuTranslateX(distance)}destroy(){this.initialized&&(this.wrapper.removeEventListener("scroll",this.eventHandlers.recalculateOverflow,{passive:!0}),window.removeEventListener("resize",this.eventHandlers.debounceScroller),this.arrows.forEach(arrow=>{arrow.removeEventListener("click",this.eventHandlers.onArrowClick)}))}_recalculateOverflow(){const overflowValue=this._getOverflowValue();this._setOverflowClass(overflowValue)}_setupEventHandlers(){this.eventHandlers=this._getEventHandlers(),this.wrapper.addEventListener("scroll",this.eventHandlers.recalculateOverflow,{passive:!0}),window.addEventListener("resize",this.eventHandlers.debounceScroller),this.arrows.forEach(arrow=>{arrow.addEventListener("click",this.eventHandlers.onArrowClick)})}_getEventHandlers(){return{recalculateOverflow:this._recalculateOverflow.bind(this),onArrowClick:this._onArrowClick.bind(this),debounceScroller:debounce(()=>{this._recalculateOverflow()},250)}}_getOverflowValue(){this._getSelectorsDomRect();const wrapperLeft=Math.floor(this.wrapperRect.left),wrapperRight=Math.floor(this.wrapperRect.right),menuLeft=Math.floor(this.menuRect.left),menuRight=Math.floor(this.menuRect.right),leftOverflow=menuLeft<wrapperLeft,rightOverflow=menuRight>wrapperRight;let overflowValue="none";return leftOverflow&&rightOverflow?overflowValue="both":leftOverflow?overflowValue="left":rightOverflow&&(overflowValue="right"),overflowValue}_getSelectorsDomRect(){this.wrapperRect=this.wrapper.getBoundingClientRect(),this.menuRect=this.menu.getBoundingClientRect()}_setOverflowClass(overflowValue){this.overflowValue!==overflowValue&&(this.wrapper.classList.remove(`${selectorsScrollerContent.wrapper}--${this.overflowValue}`),window.requestAnimationFrame(()=>{this.wrapper.classList.add(`${selectorsScrollerContent.wrapper}--${overflowValue}`),this.overflowValue=overflowValue}))}_onArrowClick(event){if(this.isTransitioning)return;this.isTransitioning=!0,this.direction=event.currentTarget.dataset.scrollerArrowDirection;const offset=config.offset;let distance=this._getDistanceToNextPosition();distance=distance<offset*2?distance:offset,this._setMenuTranslateX(distance)}_getDistanceToNextPosition(){return this.direction==="next"?Math.round(this.menuRect.right-this.wrapperRect.right):this.wrapper.scrollLeft}_getDistanceToElement(elementRight,elementLeft,offset){if(this.direction==="next"){const maxDistance=Math.ceil(this.menuRect.width-this.wrapperRect.width-this.wrapper.scrollLeft);let distance2=Math.round(elementRight-this.wrapperRect.right)+offset;return distance2=distance2<maxDistance?distance2:maxDistance,distance2}let distance=this.wrapper.scrollLeft-elementLeft+offset;return distance=distance<this.wrapper.scrollLeft?distance:this.wrapper.scrollLeft,distance}_setMenuTranslateX(distance){const translateValue=this.direction==="next"?-distance:distance;this.menu.style.transform=`translateX(${translateValue}px)`,this.translatedValue=translateValue,this.menu.classList.remove(selectorsScrollerContent.noTransition),promiseTransitionEnd(this.menu).then(()=>{this._setWrapperScrollLeft(),this.isTransitioning=!1})}_setWrapperScrollLeft(){const translatedValue=Math.abs(this.translatedValue);this.menu.style.transform="none",this.menu.classList.add(selectorsScrollerContent.noTransition),this.direction==="previous"?this.wrapper.scrollLeft-=translatedValue:this.wrapper.scrollLeft+=translatedValue}}const selectorsSticky={stickyElement:"[data-sticky-element]",stickySentinelTop:"[data-sticky-sentinel-top]",stickySentinelBottom:"[data-sticky-sentinel-bottom]"},selectorsStickyContent={stickyContainer:"sticky__container",stickySentinel:"sticky__sentinel",stickySentinelTop:"sticky__sentinel--top",stickySentinelBottom:"sticky__sentinel--bottom",stickyElement:"sticky__element"};class StickyElement{constructor(container){this.container=container}init(){isIntersectionObserverAvailable()&&(this.stickyElement=this.container.querySelector(selectorsSticky.stickyElement),this.stickyElement&&(this.sticky=!0,this._addSentinels(),this._observeTopSentinel(),this._observeBottomSentinel()))}destroy(){this.topObserver&&this.topObserver.disconnect(),this.bottomObserver&&this.bottomObserver.disconnect()}isSticky(){return this.sticky}_fireEvent(){document.dispatchEvent(new window.CustomEvent("elementSticky",{detail:{stickyElement:this.stickyElement,isSticky:this.sticky,container:this.container}}))}_addSentinels(){const sentinelTop=document.createElement("div");sentinelTop.classList.add(selectorsStickyContent.stickySentinel,selectorsStickyContent.stickySentinelTop),sentinelTop.dataset.stickySentinelTop="",this.container.classList.add(selectorsStickyContent.stickyContainer),this.stickyElement.insertAdjacentElement("beforebegin",sentinelTop);const sentinelBottom=document.createElement("div");sentinelBottom.classList.add(selectorsStickyContent.stickySentinel,selectorsStickyContent.stickySentinelBottom),sentinelBottom.dataset.stickySentinelBottom="",this.stickyElement.parentElement.appendChild(sentinelBottom)}_observeTopSentinel(){const topSentinel=this.container.querySelector(selectorsSticky.stickySentinelTop);topSentinel&&(this.topObserver=new IntersectionObserver(records=>{records.forEach(record=>{const targetInfo=record.boundingClientRect;let rootBoundsInfo;record.rootBounds===null||record.rootBounds===void 0?rootBoundsInfo=100:rootBoundsInfo=record.rootBounds;const startedSticking=targetInfo.bottom<rootBoundsInfo.top,stoppedSticking=targetInfo.bottom>=rootBoundsInfo.top&&targetInfo.bottom<rootBoundsInfo.bottom;startedSticking&&(this.sticky=!0,this.stickyElement.classList.add(selectorsStickyContent.stickyElement),this._fireEvent()),stoppedSticking&&(this.sticky=!1,this.stickyElement.classList.remove(selectorsStickyContent.stickyElement),this._fireEvent())})}),this.topObserver.observe(topSentinel))}_observeBottomSentinel(){const bottomSentinel=this.container.querySelector(selectorsSticky.stickySentinelBottom);if(!bottomSentinel)return;let previousY=0;this.bottomObserver=new IntersectionObserver(records=>{records.forEach(record=>{const targetInfo=record.boundingClientRect;let rootBoundsInfo;record.rootBounds===null||record.rootBounds===void 0?rootBoundsInfo=100:rootBoundsInfo=record.rootBounds;const ratio=record.intersectionRatio,scrollingDown=previousY>record.boundingClientRect.y;previousY=record.boundingClientRect.y;const startedSticking=targetInfo.bottom>rootBoundsInfo.top&&ratio===1,stoppedSticking=targetInfo.top<rootBoundsInfo.top&&targetInfo.bottom<rootBoundsInfo.bottom;!scrollingDown&&startedSticking&&(this.sticky=!0,this.stickyElement.classList.add(selectorsStickyContent.stickyElement),this._fireEvent()),stoppedSticking&&(this.sticky=!1,this.stickyElement.classList.remove(selectorsStickyContent.stickyElement),this._fireEvent())})}),this.bottomObserver.observe(bottomSentinel)}}const selectorsTabs={scrollerContent:"[data-scroller-content]",productTabs:"[data-product-tabs-tab]",productTabsSelectedTab:"[data-product-tabs-selected-tab]",productTabsPanel:"[data-product-tabs-tab-panel]",productTabsWrapper:"[data-product-tabs-wrapper]",productTabsTemplatePage:"[template-page-js]"},selectorsTabsContent={productTabsPanelActive:"product-tabs__panel--active",productTabsPanelVisible:"product-tabs__panel--visible",productTabsTabActive:"product-tabs-tab__item--active"};class ProductTabs extends HTMLElement{constructor(){super(),window.theme.initWhenVisible({threshold:.5,callback:this.onLoad.bind(this),element:this})}onLoad(){this.elements=this._getElements(),this.scroller=new Scroller(this),this.scroller.init(),this.stickyNav=new StickyElement(this),this.stickyNav.init(),this.hasSingleTab=!!this.dataset.singleTab,this._setupEventHandlers()}onUnload(){this.elements.tabs&&(this.stickyNav.destroy(),this.scroller.destroy(),this.elements.tabs.forEach(tab=>{tab.removeEventListener("click",this.eventHandlers.onClickTabHandler),tab.removeEventListener("keydown",this.eventHandlers.onKeyDownTabHandler)}))}connectedCallback(){window.addEventListener("DOMContentLoaded",()=>{const selectedBlock=document.querySelector("[data-product-tabs-selected-tab]"),selectedBlockContent=document.querySelector(".product-tabs__panel--active");selectedBlock&&this.getSectionPage(selectedBlock,selectedBlockContent)})}onBlockSelect(event){if(this.hasSingleTab)return;const selectedBlock=this.querySelector(`[data-product-tabs-block-id="${event}"]`);if(!selectedBlock)return;const selectedTab=selectedBlock.dataset.productTabsTabNumber;this.showTabPanel(selectedTab)}_getElements(){return{tabs:this.querySelectorAll(selectorsTabs.productTabs),tabsPanel:this.querySelectorAll(selectorsTabs.productTabsPanel),tabsPanelWrapper:this.querySelector(selectorsTabs.productTabsWrapper)}}_getEventHandlers(){return{onClickTabHandler:this.onClickTabHandler.bind(this),onKeyDownTabHandler:this.onKeyDownTabHandler.bind(this),onKeyUpTabHandler:this.onKeyUpTabHandler.bind(this)}}_setupEventHandlers(){this.eventHandlers=this._getEventHandlers(),!(!this.elements.tabs||this.hasSingleTab)&&this.elements.tabs.forEach(tab=>{tab.addEventListener("click",this.eventHandlers.onClickTabHandler),tab.addEventListener("keydown",this.eventHandlers.onKeyDownTabHandler),tab.addEventListener("keyup",this.eventHandlers.onKeyUpTabHandler)})}onKeyDownTabHandler(event){[keyCodes.HOME,keyCodes.END,keyCodes.RIGHT,keyCodes.LEFT].includes(event.key.toLowerCase())&&event.preventDefault()}onKeyUpTabHandler(event){const currentElement=event.currentTarget,lastElementIndex=this.elements.tabs.length-1,currentElementIndex=Number(currentElement.dataset.productTabsTabNumber);let index=-1;switch(event.key.toLowerCase()){case keyCodes.HOME:{index=0;break}case keyCodes.END:{index=lastElementIndex;break}case keyCodes.RIGHT:{index=currentElementIndex===lastElementIndex?0:currentElementIndex+1;break}case keyCodes.LEFT:{index=currentElementIndex===0?lastElementIndex:currentElementIndex-1;break}}index!==-1&&currentElementIndex!==index&&(event.preventDefault(),this.showTabPanel(index))}onClickTabHandler(event){const index=event.currentTarget.dataset.productTabsTabNumber;this.showTabPanel(index)}getSectionPage(currentTab,currentTabPanel){let tabContentSpinner="";const attributeEditor="data-shopify-editor-section",{productTabsTemplatePage}=selectorsTabs,{productTabsTabActive}=selectorsTabsContent,template=currentTabPanel.querySelector(productTabsTemplatePage),loadedSection=currentTabPanel.querySelector(".loading-section");if(!template||loadedSection)return;const pageUrl=currentTab.getAttribute("data-page-url");if(!(currentTab.hasAttribute("data-page-url")&&currentTab.classList.contains(productTabsTabActive)))return;tabContentSpinner+=`<div class="loading-overlay__spinner d-flex justify-content-center">
    <svg
      aria-hidden="true"
      focusable="false"
      class="spinner"
      viewBox="0 0 66 66"
      xmlns="http://www.w3.org/2000/svg"
    >
      <circle class="path" fill="none" stroke-width="6" cx="33" cy="33" r="30"></circle>
    </svg>
  </div>`;const preloader=document.createElement("div");preloader.className="preloader d-flex justify-content-center",preloader.innerHTML=tabContentSpinner,currentTabPanel.append(preloader),fetch(pageUrl).then(response=>response.text()).then(responseText=>{preloader.remove();const pageElements=[...new DOMParser().parseFromString(responseText,"text/html").querySelectorAll('section[id^="shopify-section-template-"]')];pageElements&&pageElements.forEach(pageElem=>{const elemSection=document.createElement("div"),attributes=pageElem.attributes;for(let i=0;i<attributes.length;i++)elemSection.setAttribute(attributes[i].name,attributes[i].value),elemSection.hasAttribute(attributeEditor)&&elemSection.removeAttribute(attributeEditor);elemSection.innerHTML=pageElem.innerHTML,pageElem.parentNode.replaceChild(elemSection,pageElem),elemSection.classList.add("loading-section"),template.append(elemSection)})}).catch(error=>console.error("Failed to load content for tabs",error))}showTabPanel(index){const targetTab=this.elements.tabs[index],offsetPosition=this.elements.tabsPanelWrapper.getBoundingClientRect().top+window.pageYOffset-250;this.stickyNav.isSticky()&&window.scrollTo({top:offsetPosition}),this.elements.tabs.forEach(tab=>{tab.classList.remove(selectorsTabsContent.productTabsTabActive),tab.setAttribute("aria-selected",!1),tab.setAttribute("tabindex",-1),delete tab.dataset.productTabsSelectedTab,tab.blur()}),targetTab.classList.add(selectorsTabsContent.productTabsTabActive),targetTab.setAttribute("aria-selected",!0),targetTab.setAttribute("tabindex",0),targetTab.dataset.productTabsSelectedTab=!0,targetTab.focus(),this.scroller.makeElementVisible(targetTab);const targetPanel=this.elements.tabsPanel[index];targetPanel&&(this.elements.tabsPanel.forEach(tabPanel=>{tabPanel.classList.remove(selectorsTabsContent.productTabsPanelVisible),tabPanel.classList.remove(selectorsTabsContent.productTabsPanelActive)}),targetPanel.classList.add(selectorsTabsContent.productTabsPanelActive),window.requestAnimationFrame(()=>targetPanel.classList.add(selectorsTabsContent.productTabsPanelVisible)),this.getSectionPage(targetTab,targetPanel))}}customElements.define("product-tabs",ProductTabs);
//# sourceMappingURL=/cdn/shop/t/4/assets/product-tabs-pro.js.map?v=87952987246169812081704978796
